{% extends 'base.html' %}

{% block extrahead %}
    {% load staticfiles %}
    <link href="{% static 'bootstrap-table/css/bootstrap-table.min.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
    <h2>课题组文件列表</h2>
    <table id="table"></table>
{% endblock %}

{% block extrascript %}
    <script src="{% static 'bootstrap-table/js/bootstrap-table.min.js' %}"></script>
    <script src="{% static 'bootstrap-table/js/locales/bootstrap-table-zh-CN.min.js' %}"></script>
    <script>
        function operateFormatter(value, row, index) {
            return [
                '<a class="btn btn-primary btn-sm" style="margin-right:5px;" href="' + row.file_url + '">下载</a>',
                {% if teacher %}
                    '<button type="button" class="RoleOfDelete btn btn-danger btn-sm" style="margin-right:5px;">删除</button>'
                {% endif %}
            ].join('');
        }

        window.operateEvents = {
            'click .RoleOfDelete': function (e, value, row, index) {
                console.log(row.group_file_title);
                $.post(
                    "{% url 'group_file_delete' %}",
                    {'title': row.group_file_title},
                    function (response) {
                        if (response.result)
                            $('#table').bootstrapTable('refresh');
                    }
                )
            }
        };

        $('#table').bootstrapTable({
            url: "{% url 'group_file_list' %}?table=true",
            pagination: true,
            sidePagination: "server",
            pageList: [10, 20, 50, 100, 200],
            pageSize: 20,
            search: true,
            showRefresh: true,
            showColumns: true,
            uniqueId: 'group_file_title',
            columns: [{
                field: 'group_file_title',
                title: '标题',
                sortable: true
            }, {
                field: 'group_file_describe',
                title: '描述'
            },
                {% if teacher %}
                    {
                        field: 'group_file_show',
                        title: '学生可见',
                        sortable: true
                    },
                {% endif %}
                {
                    field: 'group_file_owner',
                    title: '上传者',
                    sortable: true
                }, {
                    field: 'group_file_date',
                    title: '上传时间',
                    sortable: true
                }, {
                    field: 'operate',
                    title: '操作',
                    events: operateEvents,
                    formatter: operateFormatter
                }]
        });
    </script>
{% endblock %}