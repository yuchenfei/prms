{% extends 'base.html' %}

{% block content %}
    <form class="form" method="post">
        {% csrf_token %}
        <div class="form-group">
            <label for="name">名称</label>
            {{ form.name }}
        </div>
        <div class="form-group">
            <label for="cpu_id">CPU_ID</label>
            <input type="text" class="form-control" id="cpu_id" readonly>
            {{ form.cpu_id }}
        </div>
        {% for error in form.non_field_errors %}
            <div class="alert alert-danger">{{ error }}</div>
        {% endfor %}
        <input type="submit" class="btn btn-primary" value="提交" disabled>
    </form>
{% endblock %}

{% block extrascript %}
    <script>
        window.onload = function () {
            var id = getCpuId();
            if (id) {
                $("input#cpu_id").val(id);
                $("input#id_cpu_id").val(id);
                $("input[type='submit']").removeAttr("disabled");
            } else {
                alert("无法获取CPU信息，请使用IE，并作相应设置");
            }
        };

        function getCpuId() {
            try {
                var locator = new ActiveXObject("WbemScripting.SWbemLocator");
                var service = locator.ConnectServer(".");
                var cpu = new Enumerator(service.ExecQuery("SELECT * FROM Win32_Processor")).item();
            } catch (e) {
                return null
            }
            return cpu.ProcessorID;
        }
    </script>
{% endblock %}

